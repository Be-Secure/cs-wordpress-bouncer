version: "3"
services:
    web:
        build:
            context: .
            dockerfile: ./docker/php-${CS_WORDPRESS_BOUNCER_PHP_VERSION}.Dockerfile
        links:
            - crowdsec
            - mysql
            - redis
            - memcached

        environment:
            - WORDPRESS_DB_PASSWORD=super_secret_password
            - WORDPRESS_DEBUG=1
            #- WORDPRESS_CONFIG_EXTRA=define('DISABLE_WP_CRON', true);
        # more here https://hub.docker.com/_/wordpress
        ports:
            - "80:80"
        volumes:
            - .:/var/www/html/wp-content/plugins/cs-wordpress-bouncer

            # Optional (only if your want to make changes to library source code in the same time)
            # Set the absolute path to the source of the library below to both sides of the volume.
            # This technique is required when symlinking in docker containers, as mentionned here.
            # https://stackoverflow.com/questions/38485607/mount-host-directory-with-a-symbolic-link-inside-in-docker-container/40322275#40322275
            - ${CS_PHPLIB_ABS_PATH}:${CS_PHPLIB_ABS_PATH}
    crowdsec:
        image: crowdsecurity/crowdsec:v1.0.0
        environment:
            - DISABLE_AGENT=true
    mysql:
        image: mysql:5.7
        environment:
            - MYSQL_ROOT_PASSWORD=super_secret_password
            - MYSQL_DATABASE=wordpress
    redis:
        image: redis:6-alpine
        ports:
            - "6379:6379"
    memcached:
        image: memcached:1-alpine
